#!/bin/bash

# Set the input and output file paths
input_file="path/to/audio/file.wav"
output_dir="path/to/output/directory"

# Set the paths to the necessary files and directories
LIUM_JAR="path/to/lium.jar"
FEATURES_DIR="path/to/features/directory"
MODEL_DIR="path/to/model/directory"

# Extract acoustic features from the input audio file
java -Xmx2G -jar "$LIUM_JAR" \
    --fInputMask="$input_file" \
    --fOutputMask="$FEATURES_DIR/#stem#.mfcc" \
    --sInputMask="" \
    --sOutputMask="" \
    --doCEClustering false \
    --cMinimumLength=500 \
    fr.lium.spkDiarization.programs.MSegInit --trace \
    --fInputDesc="audio16kHz2sphinx,1:1:0:0:0:0,13,0:0:0" \
    --fOutputDesc="sbnf,0:1:0:0:0:0,13,0:0:0" \
    "$input_file"

# Train the speaker diarization model
java -Xmx4G -jar "$LIUM_JAR" \
    --fInputMask="$FEATURES_DIR/#stem#.mfcc" \
    --sInputMask="" \
    --sOutputMask="$MODEL_DIR/#stem#.model" \
    --cOutputMask="$MODEL_DIR/#stem#.cluster" \
    --emInitMethod=copy \
    --emCtrl=1,5,0.01 \
    --emNstart=1 \
    --emNmix=64 \
    --varianceControl=0.05 \
    --tInputMask="$input_file.rttm" \
    --tOutputMask="$output_dir/#stem#.rttm" \
    --doCEClustering=false \
    --doZCRClustering=false \
    --doIMSClustering=false \
    --trace \
    --fInputDesc="sbnf,0:1:0:0:0:0,13,0:0:0" \
    "$input_file"

echo "Training complete."
